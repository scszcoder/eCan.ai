{
  "mainSheetId": "main",
  "sheets": [
    {
      "id": "main",
      "name": "Main",
      "document": {
        "nodes": [
          {
            "id": "start_0",
            "type": "start",
            "meta": {
              "position": {
                "x": -1852,
                "y": 677.4954089876845
              }
            },
            "data": {
              "title": "å¼€å§‹",
              "outputs": {
                "type": "object",
                "properties": {
                  "user_message": {
                    "type": "string",
                    "default": ""
                  }
                }
              },
              "breakpoint": false
            }
          },
          {
            "id": "llm_intent",
            "type": "llm",
            "meta": {
              "position": {
                "x": -1585.1121495327104,
                "y": 514
              }
            },
            "data": {
              "title": "ç†è§£ç”¨æˆ·æ„å›¾",
              "inputsValues": {
                "modelProvider": {
                  "type": "constant",
                  "content": "Ollama (Local)"
                },
                "modelName": {
                  "type": "constant",
                  "content": "qwen3:8b"
                },
                "temperature": {
                  "type": "constant",
                  "content": 0.3
                },
                "systemPrompt": {
                  "type": "template",
                  "content": "ä½ æ˜¯æ™ºèƒ½æ„å›¾è¯†åˆ«åŠ©æ‰‹ã€‚åˆ†æç”¨æˆ·è¯·æ±‚ï¼Œåˆ¤æ–­ç”¨æˆ·æƒ³è¦ï¼š\n\n1. **INDEX** - ç´¢å¼•æ–°ç½‘é¡µï¼ˆç”¨æˆ·æä¾›äº† URL æˆ–è¦æ±‚æŠ“å–/åˆ†æç½‘é¡µï¼‰\n2. **QUERY** - æŸ¥è¯¢å·²ç´¢å¼•çš„å†…å®¹ï¼ˆç”¨æˆ·è¯¢é—®å…³äºä¹‹å‰ç½‘é¡µçš„é—®é¢˜ï¼‰\n\nè¾“å‡º JSON æ ¼å¼ï¼š\n{\n  \"intent\": \"INDEX\" æˆ– \"QUERY\",\n  \"url\": \"å¦‚æœæ˜¯ INDEXï¼Œæå– URLï¼ˆå¿…é¡»æ˜¯å®Œæ•´çš„ http/https URLï¼‰\",\n  \"query\": \"å¦‚æœæ˜¯ QUERYï¼Œæå–æŸ¥è¯¢é—®é¢˜\",\n  \"extract_target\": \"å¦‚æœæ˜¯ INDEXï¼Œç”¨æˆ·æƒ³è¦æŠ“å–çš„å…·ä½“å†…å®¹ï¼ˆå¦‚ï¼šäº§å“ä¿¡æ¯ã€æ–‡ç« å†…å®¹ã€ä»·æ ¼æ•°æ®ç­‰ï¼‰\"\n}"
                },
                "prompt": {
                  "type": "template",
                  "content": "ç”¨æˆ·æ¶ˆæ¯: {user_message}\n\nè¯·åˆ†æç”¨æˆ·æ„å›¾å¹¶è¾“å‡º JSONã€‚"
                },
                "apiKey": {
                  "content": "sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
                },
                "apiHost": {
                  "content": "http://localhost:11434"
                }
              },
              "breakpoint": false,
              "inputs": {
                "type": "object",
                "properties": {
                  "modelProvider": {
                    "type": "string"
                  },
                  "modelName": {
                    "type": "string"
                  },
                  "temperature": {
                    "type": "number"
                  },
                  "systemPrompt": {
                    "type": "string"
                  },
                  "prompt": {
                    "type": "string"
                  },
                  "apiKey": {
                    "type": "object",
                    "properties": {}
                  },
                  "apiHost": {
                    "type": "object",
                    "properties": {}
                  }
                }
              }
            }
          },
          {
            "id": "code_parse_intent",
            "type": "code",
            "meta": {
              "position": {
                "x": -1309.247663551402,
                "y": 514
              }
            },
            "data": {
              "title": "è§£ææ„å›¾",
              "code": "import json\nimport re\n\n# è§£æ LLM è¾“å‡º\nllm_result = state.get('result', {}).get('llm_result', '')\n\n# åˆå§‹åŒ– attributes\nif 'attributes' not in state:\n    state['attributes'] = {}\n\ntry:\n    # å°è¯•ä» JSON ä¸­æå–\n    intent_data = json.loads(llm_result)\n    intent = intent_data.get('intent', 'QUERY').upper()\n    \n    if intent == 'INDEX':\n        url = intent_data.get('url', '')\n        # å¦‚æœ JSON ä¸­æ²¡æœ‰ URLï¼Œå°è¯•ä»åŸå§‹æ¶ˆæ¯ä¸­æå–\n        if not url:\n            user_msg = state.get('attributes', {}).get('user_message', '')\n            url_match = re.search(r'https?://[^\\s]+', user_msg)\n            url = url_match.group(0) if url_match else ''\n        \n        # éªŒè¯ URL æ ¼å¼\n        if url and (url.startswith('http://') or url.startswith('https://')):\n            state['attributes']['url'] = url\n            state['attributes']['extract_target'] = intent_data.get('extract_target', 'é¡µé¢ä¸»è¦å†…å®¹')\n            state['attributes']['is_index'] = True\n            state['attributes']['intent'] = 'INDEX'\n        else:\n            # URL æ— æ•ˆï¼Œé™çº§ä¸ºæŸ¥è¯¢\n            state['attributes']['query'] = state.get('attributes', {}).get('user_message', '')\n            state['attributes']['is_index'] = False\n            state['attributes']['intent'] = 'QUERY'\n            state['attributes']['error_msg'] = 'æœªæ‰¾åˆ°æœ‰æ•ˆçš„ URLï¼Œå°†ä½œä¸ºæŸ¥è¯¢å¤„ç†'\n    else:\n        query = intent_data.get('query', state.get('attributes', {}).get('user_message', ''))\n        state['attributes']['query'] = query\n        state['attributes']['is_index'] = False\n        state['attributes']['intent'] = 'QUERY'\n        \nexcept Exception as e:\n    # é™çº§ï¼šå°è¯•ä»åŸå§‹æ¶ˆæ¯ä¸­æ£€æµ‹ URL\n    user_msg = state.get('attributes', {}).get('user_message', '')\n    url_match = re.search(r'https?://[^\\s]+', user_msg)\n    \n    if url_match:\n        # æœ‰ URLï¼Œåˆ¤æ–­ä¸ºç´¢å¼•\n        state['attributes']['url'] = url_match.group(0)\n        state['attributes']['extract_target'] = 'é¡µé¢ä¸»è¦å†…å®¹'\n        state['attributes']['is_index'] = True\n        state['attributes']['intent'] = 'INDEX'\n    else:\n        # æ—  URLï¼Œåˆ¤æ–­ä¸ºæŸ¥è¯¢\n        state['attributes']['query'] = user_msg\n        state['attributes']['is_index'] = False\n        state['attributes']['intent'] = 'QUERY'\n\nreturn state",
              "breakpoint": false
            }
          },
          {
            "id": "condition_intent",
            "type": "condition",
            "meta": {
              "position": {
                "x": -1024.2429906542056,
                "y": 514
              }
            },
            "data": {
              "title": "è·¯ç”±åˆ†å‘",
              "conditions": [
                {
                  "key": "if_index",
                  "value": {
                    "mode": "custom",
                    "expr": "state.get('attributes', {}).get('is_index', False)"
                  }
                },
                {
                  "key": "else_query",
                  "value": {}
                }
              ],
              "breakpoint": false
            }
          },
          {
            "id": "browser_scrape",
            "type": "browser-automation",
            "meta": {
              "position": {
                "x": -709,
                "y": 380
              }
            },
            "data": {
              "title": "Browser-Use æŠ“å–ç½‘é¡µ",
              "inputsValues": {
                "tool": {
                  "type": "constant",
                  "content": "browser-use"
                },
                "browser": {
                  "type": "constant",
                  "content": "new chromium"
                },
                "browserDriver": {
                  "type": "constant",
                  "content": "native"
                },
                "modelProvider": {
                  "type": "constant",
                  "content": "OpenAI"
                },
                "modelName": {
                  "type": "constant",
                  "content": "gpt-4o"
                },
                "temperature": {
                  "type": "constant",
                  "content": 0.3
                },
                "systemPrompt": {
                  "type": "template",
                  "content": "ä½ æ˜¯ä¸“ä¸šçš„ç½‘é¡µå†…å®¹æå–åŠ©æ‰‹ã€‚ä½ çš„ä»»åŠ¡æ˜¯ï¼š\n1. è®¿é—®æŒ‡å®šçš„ç½‘é¡µ\n2. æå–ç”¨æˆ·éœ€è¦çš„å†…å®¹\n3. å¿½ç•¥å¹¿å‘Šã€å¯¼èˆªæ ã€é¡µè„šç­‰æ— å…³å†…å®¹\n4. ä¿æŒå†…å®¹çš„ç»“æ„å’Œæ ¼å¼\n5. ä»¥æ¸…æ™°çš„ Markdown æ ¼å¼è¾“å‡º"
                },
                "prompt": {
                  "type": "template",
                  "content": "è¯·è®¿é—®ä»¥ä¸‹ç½‘é¡µå¹¶æå–å†…å®¹ï¼š\n\n**URL**: {url}\n\n**æå–ç›®æ ‡**: {extract_target}\n\nè¯·æå–ä»¥ä¸‹ä¿¡æ¯ï¼š\n1. é¡µé¢æ ‡é¢˜\n2. {extract_target}\n3. ç›¸å…³çš„å…³é”®æ•°æ®å’Œä¿¡æ¯\n4. å¦‚æœæœ‰è¡¨æ ¼æˆ–åˆ—è¡¨ï¼Œä¿æŒå…¶ç»“æ„\n\nä»¥æ¸…æ™°çš„ Markdown æ ¼å¼è¾“å‡ºï¼Œç¡®ä¿å†…å®¹å®Œæ•´ä¸”æ˜“äºé˜…è¯»ã€‚"
                }
              },
              "breakpoint": false
            }
          },
          {
            "id": "code_format_content",
            "type": "code",
            "meta": {
              "position": {
                "x": -425.6635514018693,
                "y": 380
              }
            },
            "data": {
              "title": "æ ¼å¼åŒ–æŠ“å–å†…å®¹",
              "code": "from datetime import datetime\nimport re\n\n# ä» browser-use ç»“æœä¸­æå–å†…å®¹\nbrowser_result = state.get('tool_result', {}).get('browser_scrape', {})\nweb_content = browser_result.get('final', '')\n\n# è·å–åŸå§‹ URL å’Œæå–ç›®æ ‡\nurl = state.get('attributes', {}).get('url', 'unknown')\nextract_target = state.get('attributes', {}).get('extract_target', 'é¡µé¢å†…å®¹')\n\nif web_content:\n    # æ¸…ç†å†…å®¹ï¼šç§»é™¤è¿‡å¤šçš„ç©ºè¡Œ\n    web_content = re.sub(r'\\n{3,}', '\\n\\n', web_content)\n    \n    # åˆ›å»ºæ–‡æ¡£å…ƒæ•°æ®\n    doc_metadata = {\n        'source': url,\n        'type': 'web_page',\n        'extract_target': extract_target,\n        'extracted_at': str(datetime.now()),\n        'user': state.get('attributes', {}).get('user', 'unknown'),\n        'char_count': len(web_content),\n        'word_count': len(web_content.split())\n    }\n    \n    # å‡†å¤‡ RAG è¾“å…¥\n    state['attributes']['rag_document'] = {\n        'content': web_content,\n        'metadata': doc_metadata,\n        'title': f'Web Content: {extract_target} from {url}'\n    }\n    \n    state['attributes']['content_ready'] = True\n    state['attributes']['content_preview'] = web_content[:500] + '...' if len(web_content) > 500 else web_content\nelse:\n    state['attributes']['content_ready'] = False\n    state['attributes']['error'] = 'Failed to extract web content'\n\nreturn state",
              "breakpoint": false
            }
          },
          {
            "id": "mcp_insert",
            "type": "mcp",
            "meta": {
              "position": {
                "x": -112,
                "y": 380
              }
            },
            "data": {
              "title": "MCP RAG ç´¢å¼•",
              "callable": {
                "id": "ragify",
                "name": "ragify",
                "desc": "Insert document into LightRAG",
                "params": {
                  "type": "object",
                  "properties": {
                    "input": {
                      "type": "object",
                      "properties": {
                        "text": {
                          "type": "string"
                        },
                        "file_source": {
                          "type": "string"
                        }
                      }
                    }
                  }
                },
                "type": "mcp",
                "source": "local"
              },
              "inputsValues": {
                "input": {
                  "type": "code",
                  "content": "{\n  'text': state.get('attributes', {}).get('rag_document', {}).get('content', ''),\n  'file_source': state.get('attributes', {}).get('url', 'unknown')\n}"
                }
              },
              "breakpoint": false,
              "inputs": {
                "type": "object",
                "properties": {
                  "input": {
                    "type": "object",
                    "properties": {}
                  }
                }
              }
            }
          },
          {
            "id": "code_index_result",
            "type": "code",
            "meta": {
              "position": {
                "x": 200,
                "y": 380
              }
            },
            "data": {
              "title": "æ ¼å¼åŒ–ç´¢å¼•ç»“æœ",
              "code": "url = state.get('attributes', {}).get('url', '')\nextract_target = state.get('attributes', {}).get('extract_target', 'å†…å®¹')\nmcp_result = state.get('tool_result', {}).get('mcp_insert', {})\ncontent_preview = state.get('attributes', {}).get('content_preview', '')\n\nif mcp_result.get('success'):\n    track_id = mcp_result.get('data', {}).get('track_id', 'N/A')\n    state['attributes']['response'] = f\"\"\"âœ… ç½‘é¡µå†…å®¹å·²æˆåŠŸç´¢å¼•åˆ° RAG çŸ¥è¯†åº“ï¼\n\n**æ¥æº**: {url}\n**æå–å†…å®¹**: {extract_target}\n**Track ID**: {track_id}\n\n**å†…å®¹é¢„è§ˆ**:\n{content_preview}\n\n---\nğŸ’¡ ç°åœ¨ä½ å¯ä»¥è¯¢é—®å…³äºè¿™ä¸ªç½‘é¡µçš„ä»»ä½•é—®é¢˜äº†ï¼\"\"\"\nelse:\n    error = mcp_result.get('error', 'Unknown error')\n    state['attributes']['response'] = f\"âŒ ç´¢å¼•å¤±è´¥: {error}\\n\\nè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œ RAG æœåŠ¡çŠ¶æ€ã€‚\"\n\nreturn state",
              "breakpoint": false
            }
          },
          {
            "id": "mcp_query",
            "type": "mcp",
            "meta": {
              "position": {
                "x": -709,
                "y": 648
              }
            },
            "data": {
              "title": "MCP RAG æŸ¥è¯¢",
              "callable": {
                "id": "rag_query",
                "name": "rag_query",
                "desc": "Query LightRAG knowledge base",
                "params": {
                  "type": "object",
                  "properties": {
                    "input": {
                      "type": "object",
                      "properties": {
                        "query": {
                          "type": "string"
                        },
                        "mode": {
                          "type": "string"
                        },
                        "top_k": {
                          "type": "integer"
                        },
                        "enable_rerank": {
                          "type": "boolean"
                        },
                        "include_references": {
                          "type": "boolean"
                        }
                      }
                    }
                  }
                },
                "type": "mcp",
                "source": "local"
              },
              "inputsValues": {
                "input": {
                  "type": "code",
                  "content": "{\n  'query': state.get('attributes', {}).get('query', ''),\n  'mode': 'hybrid',\n  'top_k': 5,\n  'enable_rerank': True,\n  'include_references': True\n}"
                }
              },
              "breakpoint": false,
              "inputs": {
                "type": "object",
                "properties": {
                  "input": {
                    "type": "object",
                    "properties": {}
                  }
                }
              }
            }
          },
          {
            "id": "code_process_query",
            "type": "code",
            "meta": {
              "position": {
                "x": -425.6635514018694,
                "y": 648
              }
            },
            "data": {
              "title": "å¤„ç†æŸ¥è¯¢ç»“æœ",
              "code": "# è·å– RAG æŸ¥è¯¢ç»“æœ\nrag_result = state.get('tool_result', {}).get('mcp_query', {})\n\nif rag_result.get('success'):\n    data = rag_result.get('data', {})\n    \n    # LightRAG è¿”å› {\"response\": \"...\", \"references\": [...]}\n    if isinstance(data, dict):\n        answer = data.get('response', '')\n        references = data.get('references', [])\n        \n        # æ ¼å¼åŒ–å¼•ç”¨\n        formatted_refs = []\n        for i, ref in enumerate(references[:5], 1):\n            source = ref.get('source', 'Unknown')\n            content = ref.get('content', '')[:200]\n            formatted_refs.append(f\"ğŸ“„ [{i}] {source}\\n   {content}...\")\n        \n        state['attributes']['rag_answer'] = answer\n        state['attributes']['formatted_references'] = '\\n\\n'.join(formatted_refs) if formatted_refs else 'æ— å¼•ç”¨'\n        state['attributes']['has_results'] = True\n    else:\n        state['attributes']['rag_answer'] = str(data)\n        state['attributes']['formatted_references'] = ''\n        state['attributes']['has_results'] = True\nelse:\n    state['attributes']['has_results'] = False\n    state['attributes']['rag_answer'] = ''\n    state['attributes']['formatted_references'] = ''\n    state['attributes']['error_msg'] = rag_result.get('message', 'æŸ¥è¯¢å¤±è´¥')\n\nreturn state",
              "breakpoint": false
            }
          },
          {
            "id": "llm_enhance_answer",
            "type": "llm",
            "meta": {
              "position": {
                "x": -112,
                "y": 648
              }
            },
            "data": {
              "title": "å¢å¼ºå›ç­”",
              "inputsValues": {
                "modelProvider": {
                  "type": "constant",
                  "content": "OpenAI"
                },
                "modelName": {
                  "type": "constant",
                  "content": "gpt-4o-mini"
                },
                "temperature": {
                  "type": "constant",
                  "content": 0.7
                },
                "systemPrompt": {
                  "type": "template",
                  "content": "ä½ æ˜¯ä¸“ä¸šçš„çŸ¥è¯†åŠ©æ‰‹ã€‚åŸºäº RAG æ£€ç´¢çš„å†…å®¹å›ç­”ç”¨æˆ·é—®é¢˜ã€‚\n\n**è¦æ±‚**ï¼š\n1. å‡†ç¡®å¼•ç”¨æ£€ç´¢åˆ°çš„å†…å®¹\n2. å¦‚æœå†…å®¹ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œæ˜ç¡®è¯´æ˜\n3. æä¾›æ¸…æ™°ã€ç»“æ„åŒ–çš„å›ç­”\n4. æ ‡æ³¨ä¿¡æ¯æ¥æº\n5. ä½¿ç”¨ Markdown æ ¼å¼ï¼Œè®©å›ç­”æ˜“äºé˜…è¯»"
                },
                "prompt": {
                  "type": "template",
                  "content": "ç”¨æˆ·é—®é¢˜: {query}\n\n**RAG æ£€ç´¢ç»“æœ**:\n{rag_answer}\n\n**å¼•ç”¨æ¥æº**:\n{formatted_references}\n\nè¯·åŸºäºä»¥ä¸Šæ£€ç´¢ç»“æœï¼Œä¸ºç”¨æˆ·æä¾›ä¸“ä¸šã€å‡†ç¡®çš„å›ç­”ã€‚"
                }
              },
              "breakpoint": false,
              "inputs": {
                "type": "object",
                "properties": {
                  "modelProvider": {
                    "type": "string"
                  },
                  "modelName": {
                    "type": "string"
                  },
                  "temperature": {
                    "type": "number"
                  },
                  "systemPrompt": {
                    "type": "string"
                  },
                  "prompt": {
                    "type": "string"
                  }
                }
              }
            }
          },
          {
            "id": "code_final_response",
            "type": "code",
            "meta": {
              "position": {
                "x": 200,
                "y": 648
              }
            },
            "data": {
              "title": "æ ¼å¼åŒ–æœ€ç»ˆå›ç­”",
              "code": "has_results = state.get('attributes', {}).get('has_results', False)\n\nif has_results:\n    llm_result = state.get('result', {}).get('llm_result', '')\n    formatted_refs = state.get('attributes', {}).get('formatted_references', '')\n    \n    final_response = f\"\"\"{llm_result}\n\n---\n**ğŸ“š å¼•ç”¨æ¥æº**:\n{formatted_refs}\"\"\"\n    \n    state['attributes']['response'] = final_response\nelse:\n    error_msg = state.get('attributes', {}).get('error_msg', 'æœªçŸ¥é”™è¯¯')\n    state['attributes']['response'] = f\"\"\"âŒ æŸ¥è¯¢å¤±è´¥: {error_msg}\n\nğŸ’¡ **å»ºè®®**:\n1. ç¡®ä¿å·²ç»ç´¢å¼•äº†ç›¸å…³ç½‘é¡µå†…å®¹\n2. å°è¯•é‡æ–°è¡¨è¿°ä½ çš„é—®é¢˜\n3. æ£€æŸ¥ RAG æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ\"\"\"\n\nreturn state",
              "breakpoint": false
            }
          },
          {
            "id": "chat_response",
            "type": "chat",
            "meta": {
              "position": {
                "x": 496.6551227181413,
                "y": 543.4954089876845
              }
            },
            "data": {
              "title": "å‘é€å›å¤",
              "role": "assistant",
              "inputsValues": {
                "message": {
                  "type": "ref",
                  "content": [
                    "attributes",
                    "response"
                  ]
                }
              },
              "breakpoint": false,
              "data": {
                "inputsValues": {}
              }
            }
          },
          {
            "id": "end_0",
            "type": "end",
            "meta": {
              "position": {
                "x": 772.5810114420474,
                "y": 677.4954089876845
              }
            },
            "data": {
              "title": "ç»“æŸ",
              "inputsValues": {
                "success": {
                  "type": "constant",
                  "content": true
                }
              },
              "breakpoint": false,
              "data": {
                "inputsValues": {}
              },
              "inputs": {
                "type": "object",
                "properties": {
                  "success": {
                    "type": "boolean"
                  }
                }
              }
            }
          },
          {
            "id": "comment_workflow",
            "type": "comment",
            "meta": {
              "position": {
                "x": -1852,
                "y": 850
              }
            },
            "data": {
              "size": {
                "width": 280,
                "height": 180
              },
              "note": "ğŸ“‹ **Web RAG Assistant Workflow**\n\nè¿™ä¸ª skill å®ç°äº†æ™ºèƒ½ç½‘é¡µåˆ†æåŠ©æ‰‹ï¼š\n\n1. è‡ªåŠ¨è¯†åˆ«ç”¨æˆ·æ„å›¾ï¼ˆç´¢å¼•/æŸ¥è¯¢ï¼‰\n2. Browser-Use æ™ºèƒ½æŠ“å–ç½‘é¡µ\n3. LightRAG çŸ¥è¯†åº“ç´¢å¼•\n4. è‡ªç„¶è¯­è¨€æŸ¥è¯¢å’Œå›ç­”\n\n- eCan.ai Team",
              "breakpoint": false
            }
          },
          {
            "id": "comment_intent",
            "type": "comment",
            "meta": {
              "position": {
                "x": -1595.2496998064557,
                "y": 312.4177673763288
              }
            },
            "data": {
              "size": {
                "width": 239.50060038708844,
                "height": 177.58223262367116
              },
              "note": "ğŸ¤– **æ„å›¾è¯†åˆ«æ¨¡å—**\n\nä½¿ç”¨ GPT-4o-mini åˆ†æç”¨æˆ·æ¶ˆæ¯ï¼š\n- INDEX: ç”¨æˆ·æä¾› URLï¼Œéœ€è¦æŠ“å–\n- QUERY: ç”¨æˆ·æé—®ï¼Œéœ€è¦æ£€ç´¢\n\nè¾“å‡º JSON æ ¼å¼çš„æ„å›¾æ•°æ®",
              "breakpoint": false
            }
          },
          {
            "id": "comment_index_branch",
            "type": "comment",
            "meta": {
              "position": {
                "x": -709,
                "y": 200
              }
            },
            "data": {
              "size": {
                "width": 280,
                "height": 160
              },
              "note": "ğŸŒ **INDEX åˆ†æ”¯ - ç½‘é¡µç´¢å¼•**\n\n1. Browser-Use (GPT-4o) è®¿é—®ç½‘é¡µ\n2. æå–æŒ‡å®šå†…å®¹ï¼ˆMarkdown æ ¼å¼ï¼‰\n3. æ ¼å¼åŒ–å¹¶æ·»åŠ å…ƒæ•°æ®\n4. è°ƒç”¨ MCP ragify å­˜å…¥çŸ¥è¯†åº“\n5. è¿”å›ç´¢å¼•æˆåŠŸæ¶ˆæ¯",
              "breakpoint": false
            }
          },
          {
            "id": "comment_query_branch",
            "type": "comment",
            "meta": {
              "position": {
                "x": -709,
                "y": 900
              }
            },
            "data": {
              "size": {
                "width": 280,
                "height": 160
              },
              "note": "ğŸ” **QUERY åˆ†æ”¯ - çŸ¥è¯†æ£€ç´¢**\n\n1. è°ƒç”¨ MCP rag_query æŸ¥è¯¢çŸ¥è¯†åº“\n2. ä½¿ç”¨ hybrid æ¨¡å¼ + rerank\n3. æå– top 5 ç›¸å…³ç»“æœ\n4. GPT-4o-mini ç”Ÿæˆè‡ªç„¶è¯­è¨€å›ç­”\n5. é™„å¸¦å¼•ç”¨æ¥æº",
              "breakpoint": false
            }
          },
          {
            "id": "comment_mcp",
            "type": "comment",
            "meta": {
              "position": {
                "x": -112,
                "y": 200
              }
            },
            "data": {
              "size": {
                "width": 240,
                "height": 140
              },
              "note": "ğŸ”Œ **MCP RAG å·¥å…·**\n\n- ragify: æ–‡æ¡£ç´¢å¼•\n- rag_query: çŸ¥è¯†æ£€ç´¢\n\nä½¿ç”¨ LightRAG æœ¬åœ°æœåŠ¡\næ”¯æŒå¤šç§æ£€ç´¢æ¨¡å¼",
              "breakpoint": false
            }
          },
          {
            "id": "comment_final",
            "type": "comment",
            "meta": {
              "position": {
                "x": 507.10384145699373,
                "y": 302.1680675698731
              }
            },
            "data": {
              "size": {
                "width": 262.2076829139875,
                "height": 167.83193243012695
              },
              "note": "ğŸ’¬ **æœ€ç»ˆè¾“å‡º**\n\nä¸¤æ¡è·¯å¾„æ±‡èšåˆ° Chat èŠ‚ç‚¹ï¼š\n- INDEX: ç´¢å¼•æˆåŠŸæç¤º\n- QUERY: å¢å¼ºåçš„å›ç­”\n\nç»Ÿä¸€å‘é€ç»™ç”¨æˆ·",
              "breakpoint": false
            }
          }
        ],
        "edges": [
          {
            "sourceNodeID": "start_0",
            "targetNodeID": "llm_intent"
          },
          {
            "sourceNodeID": "llm_intent",
            "targetNodeID": "code_parse_intent"
          },
          {
            "sourceNodeID": "code_parse_intent",
            "targetNodeID": "condition_intent"
          },
          {
            "sourceNodeID": "condition_intent",
            "targetNodeID": "browser_scrape",
            "sourcePortID": "if_index"
          },
          {
            "sourceNodeID": "condition_intent",
            "targetNodeID": "mcp_query",
            "sourcePortID": "else_query"
          },
          {
            "sourceNodeID": "browser_scrape",
            "targetNodeID": "code_format_content"
          },
          {
            "sourceNodeID": "code_format_content",
            "targetNodeID": "mcp_insert"
          },
          {
            "sourceNodeID": "mcp_insert",
            "targetNodeID": "code_index_result"
          },
          {
            "sourceNodeID": "code_index_result",
            "targetNodeID": "chat_response"
          },
          {
            "sourceNodeID": "mcp_query",
            "targetNodeID": "code_process_query"
          },
          {
            "sourceNodeID": "code_process_query",
            "targetNodeID": "llm_enhance_answer"
          },
          {
            "sourceNodeID": "llm_enhance_answer",
            "targetNodeID": "code_final_response"
          },
          {
            "sourceNodeID": "code_final_response",
            "targetNodeID": "chat_response"
          },
          {
            "sourceNodeID": "chat_response",
            "targetNodeID": "end_0"
          }
        ]
      },
      "createdAt": 1765274263030,
      "lastOpenedAt": 1765305925020,
      "workFlow": {
        "nodes": [
          {
            "id": "start_0",
            "type": "start",
            "meta": {
              "position": {
                "x": -1852,
                "y": 677.4954089876845
              }
            },
            "data": {
              "title": "å¼€å§‹",
              "outputs": {
                "type": "object",
                "properties": {
                  "user_message": {
                    "type": "string",
                    "default": ""
                  }
                }
              },
              "breakpoint": false
            }
          },
          {
            "id": "llm_intent",
            "type": "llm",
            "meta": {
              "position": {
                "x": -1585.1121495327104,
                "y": 514
              }
            },
            "data": {
              "title": "ç†è§£ç”¨æˆ·æ„å›¾",
              "inputsValues": {
                "modelProvider": {
                  "type": "constant",
                  "content": "Ollama (Local)"
                },
                "modelName": {
                  "type": "constant",
                  "content": "qwen3:8b"
                },
                "temperature": {
                  "type": "constant",
                  "content": 0.3
                },
                "systemPrompt": {
                  "type": "template",
                  "content": "ä½ æ˜¯æ™ºèƒ½æ„å›¾è¯†åˆ«åŠ©æ‰‹ã€‚åˆ†æç”¨æˆ·è¯·æ±‚ï¼Œåˆ¤æ–­ç”¨æˆ·æƒ³è¦ï¼š\n\n1. **INDEX** - ç´¢å¼•æ–°ç½‘é¡µï¼ˆç”¨æˆ·æä¾›äº† URL æˆ–è¦æ±‚æŠ“å–/åˆ†æç½‘é¡µï¼‰\n2. **QUERY** - æŸ¥è¯¢å·²ç´¢å¼•çš„å†…å®¹ï¼ˆç”¨æˆ·è¯¢é—®å…³äºä¹‹å‰ç½‘é¡µçš„é—®é¢˜ï¼‰\n\nè¾“å‡º JSON æ ¼å¼ï¼š\n{\n  \"intent\": \"INDEX\" æˆ– \"QUERY\",\n  \"url\": \"å¦‚æœæ˜¯ INDEXï¼Œæå– URLï¼ˆå¿…é¡»æ˜¯å®Œæ•´çš„ http/https URLï¼‰\",\n  \"query\": \"å¦‚æœæ˜¯ QUERYï¼Œæå–æŸ¥è¯¢é—®é¢˜\",\n  \"extract_target\": \"å¦‚æœæ˜¯ INDEXï¼Œç”¨æˆ·æƒ³è¦æŠ“å–çš„å…·ä½“å†…å®¹ï¼ˆå¦‚ï¼šäº§å“ä¿¡æ¯ã€æ–‡ç« å†…å®¹ã€ä»·æ ¼æ•°æ®ç­‰ï¼‰\"\n}"
                },
                "prompt": {
                  "type": "template",
                  "content": "ç”¨æˆ·æ¶ˆæ¯: {user_message}\n\nè¯·åˆ†æç”¨æˆ·æ„å›¾å¹¶è¾“å‡º JSONã€‚"
                },
                "apiKey": {
                  "content": "sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
                },
                "apiHost": {
                  "content": "http://localhost:11434"
                }
              },
              "breakpoint": false,
              "inputs": {
                "type": "object",
                "properties": {
                  "modelProvider": {
                    "type": "string"
                  },
                  "modelName": {
                    "type": "string"
                  },
                  "temperature": {
                    "type": "number"
                  },
                  "systemPrompt": {
                    "type": "string"
                  },
                  "prompt": {
                    "type": "string"
                  },
                  "apiKey": {
                    "type": "object",
                    "properties": {}
                  },
                  "apiHost": {
                    "type": "object",
                    "properties": {}
                  }
                }
              }
            }
          },
          {
            "id": "code_parse_intent",
            "type": "code",
            "meta": {
              "position": {
                "x": -1309.247663551402,
                "y": 514
              }
            },
            "data": {
              "title": "è§£ææ„å›¾",
              "code": "import json\nimport re\n\n# è·å– LLM è¾“å‡º - æ­£ç¡®çš„è·¯å¾„\nllm_output = state.get('tool_result', {}).get('llm_intent', {})\nllm_text = llm_output.get('response', '') if isinstance(llm_output, dict) else str(llm_output)\n\n# è·å–ç”¨æˆ·åŸå§‹æ¶ˆæ¯\nuser_message = state.get('user_message', '')\n\n# åˆå§‹åŒ– attributes\nif 'attributes' not in state:\n    state['attributes'] = {}\n\n# ä¿å­˜ç”¨æˆ·æ¶ˆæ¯åˆ° attributes\nstate['attributes']['user_message'] = user_message\n\ntry:\n    # å°è¯•æå– JSONï¼ˆLLM å¯èƒ½è¿”å›å¸¦ä»£ç å—çš„æ ¼å¼ï¼‰\n    json_match = re.search(r'\\{[^}]+\\}', llm_text, re.DOTALL)\n    if json_match:\n        intent_data = json.loads(json_match.group(0))\n    else:\n        intent_data = json.loads(llm_text)\n    \n    intent = intent_data.get('intent', 'QUERY').upper()\n    \n    if intent == 'INDEX':\n        url = intent_data.get('url', '')\n        # å¦‚æœ JSON ä¸­æ²¡æœ‰ URLï¼Œå°è¯•ä»åŸå§‹æ¶ˆæ¯ä¸­æå–\n        if not url:\n            url_match = re.search(r'https?://[^\\s]+', user_message)\n            url = url_match.group(0) if url_match else ''\n        \n        # éªŒè¯ URL æ ¼å¼\n        if url and (url.startswith('http://') or url.startswith('https://')):\n            state['attributes']['url'] = url\n            state['attributes']['extract_target'] = intent_data.get('extract_target', 'é¡µé¢ä¸»è¦å†…å®¹')\n            state['attributes']['is_index'] = True\n            state['attributes']['intent'] = 'INDEX'\n        else:\n            # URL æ— æ•ˆï¼Œé™çº§ä¸ºæŸ¥è¯¢\n            state['attributes']['query'] = user_message\n            state['attributes']['is_index'] = False\n            state['attributes']['intent'] = 'QUERY'\n            state['attributes']['error_msg'] = 'æœªæ‰¾åˆ°æœ‰æ•ˆçš„ URLï¼Œå°†ä½œä¸ºæŸ¥è¯¢å¤„ç†'\n    else:\n        query = intent_data.get('query', user_message)\n        state['attributes']['query'] = query\n        state['attributes']['is_index'] = False\n        state['attributes']['intent'] = 'QUERY'\n        \nexcept Exception as e:\n    # é™çº§ï¼šå°è¯•ä»åŸå§‹æ¶ˆæ¯ä¸­æ£€æµ‹ URL\n    url_match = re.search(r'https?://[^\\s]+', user_message)\n    \n    if url_match:\n        # æœ‰ URLï¼Œåˆ¤æ–­ä¸ºç´¢å¼•\n        state['attributes']['url'] = url_match.group(0)\n        state['attributes']['extract_target'] = 'é¡µé¢ä¸»è¦å†…å®¹'\n        state['attributes']['is_index'] = True\n        state['attributes']['intent'] = 'INDEX'\n    else:\n        # æ²¡æœ‰ URLï¼Œåˆ¤æ–­ä¸ºæŸ¥è¯¢\n        state['attributes']['query'] = user_message\n        state['attributes']['is_index'] = False\n        state['attributes']['intent'] = 'QUERY'\n    \n    state['attributes']['parse_error'] = str(e)\n\nreturn state",
              "breakpoint": false
            }
          },
          {
            "id": "condition_intent",
            "type": "condition",
            "meta": {
              "position": {
                "x": -1024.2429906542056,
                "y": 514
              }
            },
            "data": {
              "title": "è·¯ç”±åˆ†å‘",
              "conditions": [
                {
                  "key": "if_index",
                  "value": {
                    "mode": "custom",
                    "expr": "state.get('attributes', {}).get('is_index', False)"
                  }
                },
                {
                  "key": "else_query",
                  "value": {}
                }
              ],
              "breakpoint": false
            }
          },
          {
            "id": "browser_scrape",
            "type": "browser-automation",
            "meta": {
              "position": {
                "x": -709,
                "y": 380
              }
            },
            "data": {
              "title": "Browser-Use æŠ“å–ç½‘é¡µ",
              "inputsValues": {
                "tool": {
                  "type": "constant",
                  "content": "browser-use"
                },
                "browser": {
                  "type": "constant",
                  "content": "new chromium"
                },
                "browserDriver": {
                  "type": "constant",
                  "content": "native"
                },
                "modelProvider": {
                  "type": "constant",
                  "content": "OpenAI"
                },
                "modelName": {
                  "type": "constant",
                  "content": "gpt-4o"
                },
                "temperature": {
                  "type": "constant",
                  "content": 0.3
                },
                "systemPrompt": {
                  "type": "template",
                  "content": "ä½ æ˜¯ä¸“ä¸šçš„ç½‘é¡µå†…å®¹æå–åŠ©æ‰‹ã€‚ä½ çš„ä»»åŠ¡æ˜¯ï¼š\n1. è®¿é—®æŒ‡å®šçš„ç½‘é¡µ\n2. æå–ç”¨æˆ·éœ€è¦çš„å†…å®¹\n3. å¿½ç•¥å¹¿å‘Šã€å¯¼èˆªæ ã€é¡µè„šç­‰æ— å…³å†…å®¹\n4. ä¿æŒå†…å®¹çš„ç»“æ„å’Œæ ¼å¼\n5. ä»¥æ¸…æ™°çš„ Markdown æ ¼å¼è¾“å‡º"
                },
                "prompt": {
                  "type": "template",
                  "content": "è¯·è®¿é—®ä»¥ä¸‹ç½‘é¡µå¹¶æå–å†…å®¹ï¼š\n\n**URL**: {url}\n\n**æå–ç›®æ ‡**: {extract_target}\n\nè¯·æå–ä»¥ä¸‹ä¿¡æ¯ï¼š\n1. é¡µé¢æ ‡é¢˜\n2. {extract_target}\n3. ç›¸å…³çš„å…³é”®æ•°æ®å’Œä¿¡æ¯\n4. å¦‚æœæœ‰è¡¨æ ¼æˆ–åˆ—è¡¨ï¼Œä¿æŒå…¶ç»“æ„\n\nä»¥æ¸…æ™°çš„ Markdown æ ¼å¼è¾“å‡ºï¼Œç¡®ä¿å†…å®¹å®Œæ•´ä¸”æ˜“äºé˜…è¯»ã€‚"
                }
              },
              "breakpoint": false
            }
          },
          {
            "id": "code_format_content",
            "type": "code",
            "meta": {
              "position": {
                "x": -425.6635514018693,
                "y": 380
              }
            },
            "data": {
              "title": "æ ¼å¼åŒ–æŠ“å–å†…å®¹",
              "code": "from datetime import datetime\nimport re\n\n# ä» browser-use ç»“æœä¸­æå–å†…å®¹\nbrowser_result = state.get('tool_result', {}).get('browser_scrape', {})\nweb_content = browser_result.get('final', '')\n\n# è·å–åŸå§‹ URL å’Œæå–ç›®æ ‡\nurl = state.get('attributes', {}).get('url', 'unknown')\nextract_target = state.get('attributes', {}).get('extract_target', 'é¡µé¢å†…å®¹')\n\nif web_content:\n    # æ¸…ç†å†…å®¹ï¼šç§»é™¤è¿‡å¤šçš„ç©ºè¡Œ\n    web_content = re.sub(r'\\n{3,}', '\\n\\n', web_content)\n    \n    # åˆ›å»ºæ–‡æ¡£å…ƒæ•°æ®\n    doc_metadata = {\n        'source': url,\n        'type': 'web_page',\n        'extract_target': extract_target,\n        'extracted_at': str(datetime.now()),\n        'user': state.get('attributes', {}).get('user', 'unknown'),\n        'char_count': len(web_content),\n        'word_count': len(web_content.split())\n    }\n    \n    # å‡†å¤‡ RAG è¾“å…¥\n    state['attributes']['rag_document'] = {\n        'content': web_content,\n        'metadata': doc_metadata,\n        'title': f'Web Content: {extract_target} from {url}'\n    }\n    \n    state['attributes']['content_ready'] = True\n    state['attributes']['content_preview'] = web_content[:500] + '...' if len(web_content) > 500 else web_content\nelse:\n    state['attributes']['content_ready'] = False\n    state['attributes']['error'] = 'Failed to extract web content'\n\nreturn state",
              "breakpoint": false
            }
          },
          {
            "id": "mcp_insert",
            "type": "mcp",
            "meta": {
              "position": {
                "x": -112,
                "y": 380
              }
            },
            "data": {
              "title": "MCP RAG ç´¢å¼•",
              "callable": {
                "id": "ragify",
                "name": "ragify",
                "desc": "Insert document into LightRAG",
                "params": {
                  "type": "object",
                  "properties": {
                    "input": {
                      "type": "object",
                      "properties": {
                        "text": {
                          "type": "string"
                        },
                        "file_source": {
                          "type": "string"
                        }
                      }
                    }
                  }
                },
                "type": "mcp",
                "source": "local"
              },
              "inputsValues": {
                "input": {
                  "type": "code",
                  "content": "{\n  'text': state.get('attributes', {}).get('rag_document', {}).get('content', ''),\n  'file_source': state.get('attributes', {}).get('url', 'unknown')\n}"
                }
              },
              "breakpoint": false,
              "inputs": {
                "type": "object",
                "properties": {
                  "input": {
                    "type": "object",
                    "properties": {}
                  }
                }
              }
            }
          },
          {
            "id": "code_index_result",
            "type": "code",
            "meta": {
              "position": {
                "x": 200,
                "y": 380
              }
            },
            "data": {
              "title": "æ ¼å¼åŒ–ç´¢å¼•ç»“æœ",
              "code": "url = state.get('attributes', {}).get('url', '')\nextract_target = state.get('attributes', {}).get('extract_target', 'å†…å®¹')\nmcp_result = state.get('tool_result', {}).get('mcp_insert', {})\ncontent_preview = state.get('attributes', {}).get('content_preview', '')\n\nif mcp_result.get('success'):\n    track_id = mcp_result.get('data', {}).get('track_id', 'N/A')\n    state['attributes']['response'] = f\"\"\"âœ… ç½‘é¡µå†…å®¹å·²æˆåŠŸç´¢å¼•åˆ° RAG çŸ¥è¯†åº“ï¼\n\n**æ¥æº**: {url}\n**æå–å†…å®¹**: {extract_target}\n**Track ID**: {track_id}\n\n**å†…å®¹é¢„è§ˆ**:\n{content_preview}\n\n---\nğŸ’¡ ç°åœ¨ä½ å¯ä»¥è¯¢é—®å…³äºè¿™ä¸ªç½‘é¡µçš„ä»»ä½•é—®é¢˜äº†ï¼\"\"\"\nelse:\n    error = mcp_result.get('error', 'Unknown error')\n    state['attributes']['response'] = f\"âŒ ç´¢å¼•å¤±è´¥: {error}\\n\\nè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œ RAG æœåŠ¡çŠ¶æ€ã€‚\"\n\nreturn state",
              "breakpoint": false
            }
          },
          {
            "id": "mcp_query",
            "type": "mcp",
            "meta": {
              "position": {
                "x": -709,
                "y": 648
              }
            },
            "data": {
              "title": "MCP RAG æŸ¥è¯¢",
              "callable": {
                "id": "rag_query",
                "name": "rag_query",
                "desc": "Query LightRAG knowledge base",
                "params": {
                  "type": "object",
                  "properties": {
                    "input": {
                      "type": "object",
                      "properties": {
                        "query": {
                          "type": "string"
                        },
                        "mode": {
                          "type": "string"
                        },
                        "top_k": {
                          "type": "integer"
                        },
                        "enable_rerank": {
                          "type": "boolean"
                        },
                        "include_references": {
                          "type": "boolean"
                        }
                      }
                    }
                  }
                },
                "type": "mcp",
                "source": "local"
              },
              "inputsValues": {
                "input": {
                  "type": "code",
                  "content": "{\n  'query': state.get('attributes', {}).get('query', ''),\n  'mode': 'hybrid',\n  'top_k': 5,\n  'enable_rerank': True,\n  'include_references': True\n}"
                }
              },
              "breakpoint": false,
              "inputs": {
                "type": "object",
                "properties": {
                  "input": {
                    "type": "object",
                    "properties": {}
                  }
                }
              }
            }
          },
          {
            "id": "code_process_query",
            "type": "code",
            "meta": {
              "position": {
                "x": -425.6635514018694,
                "y": 648
              }
            },
            "data": {
              "title": "å¤„ç†æŸ¥è¯¢ç»“æœ",
              "code": "# è·å– RAG æŸ¥è¯¢ç»“æœ\nrag_result = state.get('tool_result', {}).get('mcp_query', {})\n\nif rag_result.get('success'):\n    data = rag_result.get('data', {})\n    \n    # LightRAG è¿”å› {\"response\": \"...\", \"references\": [...]}\n    if isinstance(data, dict):\n        answer = data.get('response', '')\n        references = data.get('references', [])\n        \n        # æ ¼å¼åŒ–å¼•ç”¨\n        formatted_refs = []\n        for i, ref in enumerate(references[:5], 1):\n            source = ref.get('source', 'Unknown')\n            content = ref.get('content', '')[:200]\n            formatted_refs.append(f\"ğŸ“„ [{i}] {source}\\n   {content}...\")\n        \n        state['attributes']['rag_answer'] = answer\n        state['attributes']['formatted_references'] = '\\n\\n'.join(formatted_refs) if formatted_refs else 'æ— å¼•ç”¨'\n        state['attributes']['has_results'] = True\n    else:\n        state['attributes']['rag_answer'] = str(data)\n        state['attributes']['formatted_references'] = ''\n        state['attributes']['has_results'] = True\nelse:\n    state['attributes']['has_results'] = False\n    state['attributes']['rag_answer'] = ''\n    state['attributes']['formatted_references'] = ''\n    state['attributes']['error_msg'] = rag_result.get('message', 'æŸ¥è¯¢å¤±è´¥')\n\nreturn state",
              "breakpoint": false
            }
          },
          {
            "id": "llm_enhance_answer",
            "type": "llm",
            "meta": {
              "position": {
                "x": -112,
                "y": 648
              }
            },
            "data": {
              "title": "å¢å¼ºå›ç­”",
              "inputsValues": {
                "modelProvider": {
                  "type": "constant",
                  "content": "OpenAI"
                },
                "modelName": {
                  "type": "constant",
                  "content": "gpt-4o-mini"
                },
                "temperature": {
                  "type": "constant",
                  "content": 0.7
                },
                "systemPrompt": {
                  "type": "template",
                  "content": "ä½ æ˜¯ä¸“ä¸šçš„çŸ¥è¯†åŠ©æ‰‹ã€‚åŸºäº RAG æ£€ç´¢çš„å†…å®¹å›ç­”ç”¨æˆ·é—®é¢˜ã€‚\n\n**è¦æ±‚**ï¼š\n1. å‡†ç¡®å¼•ç”¨æ£€ç´¢åˆ°çš„å†…å®¹\n2. å¦‚æœå†…å®¹ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œæ˜ç¡®è¯´æ˜\n3. æä¾›æ¸…æ™°ã€ç»“æ„åŒ–çš„å›ç­”\n4. æ ‡æ³¨ä¿¡æ¯æ¥æº\n5. ä½¿ç”¨ Markdown æ ¼å¼ï¼Œè®©å›ç­”æ˜“äºé˜…è¯»"
                },
                "prompt": {
                  "type": "template",
                  "content": "ç”¨æˆ·é—®é¢˜: {query}\n\n**RAG æ£€ç´¢ç»“æœ**:\n{rag_answer}\n\n**å¼•ç”¨æ¥æº**:\n{formatted_references}\n\nè¯·åŸºäºä»¥ä¸Šæ£€ç´¢ç»“æœï¼Œä¸ºç”¨æˆ·æä¾›ä¸“ä¸šã€å‡†ç¡®çš„å›ç­”ã€‚"
                }
              },
              "breakpoint": false,
              "inputs": {
                "type": "object",
                "properties": {
                  "modelProvider": {
                    "type": "string"
                  },
                  "modelName": {
                    "type": "string"
                  },
                  "temperature": {
                    "type": "number"
                  },
                  "systemPrompt": {
                    "type": "string"
                  },
                  "prompt": {
                    "type": "string"
                  }
                }
              }
            }
          },
          {
            "id": "code_final_response",
            "type": "code",
            "meta": {
              "position": {
                "x": 200,
                "y": 648
              }
            },
            "data": {
              "title": "æ ¼å¼åŒ–æœ€ç»ˆå›ç­”",
              "code": "has_results = state.get('attributes', {}).get('has_results', False)\n\nif has_results:\n    llm_result = state.get('result', {}).get('llm_result', '')\n    formatted_refs = state.get('attributes', {}).get('formatted_references', '')\n    \n    final_response = f\"\"\"{llm_result}\n\n---\n**ğŸ“š å¼•ç”¨æ¥æº**:\n{formatted_refs}\"\"\"\n    \n    state['attributes']['response'] = final_response\nelse:\n    error_msg = state.get('attributes', {}).get('error_msg', 'æœªçŸ¥é”™è¯¯')\n    state['attributes']['response'] = f\"\"\"âŒ æŸ¥è¯¢å¤±è´¥: {error_msg}\n\nğŸ’¡ **å»ºè®®**:\n1. ç¡®ä¿å·²ç»ç´¢å¼•äº†ç›¸å…³ç½‘é¡µå†…å®¹\n2. å°è¯•é‡æ–°è¡¨è¿°ä½ çš„é—®é¢˜\n3. æ£€æŸ¥ RAG æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ\"\"\"\n\nreturn state",
              "breakpoint": false
            }
          },
          {
            "id": "chat_response",
            "type": "chat",
            "meta": {
              "position": {
                "x": 496.6551227181413,
                "y": 543.4954089876845
              }
            },
            "data": {
              "title": "å‘é€å›å¤",
              "role": "assistant",
              "inputsValues": {
                "message": {
                  "type": "ref",
                  "content": [
                    "attributes",
                    "response"
                  ]
                }
              },
              "breakpoint": false,
              "data": {
                "inputsValues": {}
              }
            }
          },
          {
            "id": "end_0",
            "type": "end",
            "meta": {
              "position": {
                "x": 772.5810114420474,
                "y": 677.4954089876845
              }
            },
            "data": {
              "title": "ç»“æŸ",
              "inputsValues": {
                "success": {
                  "type": "constant",
                  "content": true
                }
              },
              "breakpoint": false,
              "data": {
                "inputsValues": {}
              },
              "inputs": {
                "type": "object",
                "properties": {
                  "success": {
                    "type": "boolean"
                  }
                }
              }
            }
          },
          {
            "id": "comment_workflow",
            "type": "comment",
            "meta": {
              "position": {
                "x": -1852,
                "y": 850
              }
            },
            "data": {
              "size": {
                "width": 280,
                "height": 180
              },
              "note": "ğŸ“‹ **Web RAG Assistant Workflow**\n\nè¿™ä¸ª skill å®ç°äº†æ™ºèƒ½ç½‘é¡µåˆ†æåŠ©æ‰‹ï¼š\n\n1. è‡ªåŠ¨è¯†åˆ«ç”¨æˆ·æ„å›¾ï¼ˆç´¢å¼•/æŸ¥è¯¢ï¼‰\n2. Browser-Use æ™ºèƒ½æŠ“å–ç½‘é¡µ\n3. LightRAG çŸ¥è¯†åº“ç´¢å¼•\n4. è‡ªç„¶è¯­è¨€æŸ¥è¯¢å’Œå›ç­”\n\n- eCan.ai Team",
              "breakpoint": false
            }
          },
          {
            "id": "comment_intent",
            "type": "comment",
            "meta": {
              "position": {
                "x": -1595.2496998064557,
                "y": 312.4177673763288
              }
            },
            "data": {
              "size": {
                "width": 239.50060038708844,
                "height": 177.58223262367116
              },
              "note": "ğŸ¤– **æ„å›¾è¯†åˆ«æ¨¡å—**\n\nä½¿ç”¨ GPT-4o-mini åˆ†æç”¨æˆ·æ¶ˆæ¯ï¼š\n- INDEX: ç”¨æˆ·æä¾› URLï¼Œéœ€è¦æŠ“å–\n- QUERY: ç”¨æˆ·æé—®ï¼Œéœ€è¦æ£€ç´¢\n\nè¾“å‡º JSON æ ¼å¼çš„æ„å›¾æ•°æ®",
              "breakpoint": false
            }
          },
          {
            "id": "comment_index_branch",
            "type": "comment",
            "meta": {
              "position": {
                "x": -709,
                "y": 200
              }
            },
            "data": {
              "size": {
                "width": 280,
                "height": 160
              },
              "note": "ğŸŒ **INDEX åˆ†æ”¯ - ç½‘é¡µç´¢å¼•**\n\n1. Browser-Use (GPT-4o) è®¿é—®ç½‘é¡µ\n2. æå–æŒ‡å®šå†…å®¹ï¼ˆMarkdown æ ¼å¼ï¼‰\n3. æ ¼å¼åŒ–å¹¶æ·»åŠ å…ƒæ•°æ®\n4. è°ƒç”¨ MCP ragify å­˜å…¥çŸ¥è¯†åº“\n5. è¿”å›ç´¢å¼•æˆåŠŸæ¶ˆæ¯",
              "breakpoint": false
            }
          },
          {
            "id": "comment_query_branch",
            "type": "comment",
            "meta": {
              "position": {
                "x": -709,
                "y": 900
              }
            },
            "data": {
              "size": {
                "width": 280,
                "height": 160
              },
              "note": "ğŸ” **QUERY åˆ†æ”¯ - çŸ¥è¯†æ£€ç´¢**\n\n1. è°ƒç”¨ MCP rag_query æŸ¥è¯¢çŸ¥è¯†åº“\n2. ä½¿ç”¨ hybrid æ¨¡å¼ + rerank\n3. æå– top 5 ç›¸å…³ç»“æœ\n4. GPT-4o-mini ç”Ÿæˆè‡ªç„¶è¯­è¨€å›ç­”\n5. é™„å¸¦å¼•ç”¨æ¥æº",
              "breakpoint": false
            }
          },
          {
            "id": "comment_mcp",
            "type": "comment",
            "meta": {
              "position": {
                "x": -112,
                "y": 200
              }
            },
            "data": {
              "size": {
                "width": 240,
                "height": 140
              },
              "note": "ğŸ”Œ **MCP RAG å·¥å…·**\n\n- ragify: æ–‡æ¡£ç´¢å¼•\n- rag_query: çŸ¥è¯†æ£€ç´¢\n\nä½¿ç”¨ LightRAG æœ¬åœ°æœåŠ¡\næ”¯æŒå¤šç§æ£€ç´¢æ¨¡å¼",
              "breakpoint": false
            }
          },
          {
            "id": "comment_final",
            "type": "comment",
            "meta": {
              "position": {
                "x": 507.10384145699373,
                "y": 302.1680675698731
              }
            },
            "data": {
              "size": {
                "width": 262.2076829139875,
                "height": 167.83193243012695
              },
              "note": "ğŸ’¬ **æœ€ç»ˆè¾“å‡º**\n\nä¸¤æ¡è·¯å¾„æ±‡èšåˆ° Chat èŠ‚ç‚¹ï¼š\n- INDEX: ç´¢å¼•æˆåŠŸæç¤º\n- QUERY: å¢å¼ºåçš„å›ç­”\n\nç»Ÿä¸€å‘é€ç»™ç”¨æˆ·",
              "breakpoint": false
            }
          }
        ],
        "edges": [
          {
            "sourceNodeID": "start_0",
            "targetNodeID": "llm_intent"
          },
          {
            "sourceNodeID": "llm_intent",
            "targetNodeID": "code_parse_intent"
          },
          {
            "sourceNodeID": "code_parse_intent",
            "targetNodeID": "condition_intent"
          },
          {
            "sourceNodeID": "condition_intent",
            "targetNodeID": "browser_scrape",
            "sourcePortID": "if_index"
          },
          {
            "sourceNodeID": "condition_intent",
            "targetNodeID": "mcp_query",
            "sourcePortID": "else_query"
          },
          {
            "sourceNodeID": "browser_scrape",
            "targetNodeID": "code_format_content"
          },
          {
            "sourceNodeID": "code_format_content",
            "targetNodeID": "mcp_insert"
          },
          {
            "sourceNodeID": "mcp_insert",
            "targetNodeID": "code_index_result"
          },
          {
            "sourceNodeID": "code_index_result",
            "targetNodeID": "chat_response"
          },
          {
            "sourceNodeID": "mcp_query",
            "targetNodeID": "code_process_query"
          },
          {
            "sourceNodeID": "code_process_query",
            "targetNodeID": "llm_enhance_answer"
          },
          {
            "sourceNodeID": "llm_enhance_answer",
            "targetNodeID": "code_final_response"
          },
          {
            "sourceNodeID": "code_final_response",
            "targetNodeID": "chat_response"
          },
          {
            "sourceNodeID": "chat_response",
            "targetNodeID": "end_0"
          }
        ]
      }
    }
  ],
  "openTabs": [
    "main"
  ],
  "activeSheetId": "main"
}