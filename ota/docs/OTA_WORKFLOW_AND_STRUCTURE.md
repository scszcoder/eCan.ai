# eCan OTA æ›´æ–°ç³»ç»Ÿ - å®Œæ•´å·¥ä½œæµç¨‹ä¸ç›®å½•ç»“æ„

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [OTA å·¥ä½œæµç¨‹](#ota-å·¥ä½œæµç¨‹)
3. [ç›®å½•ç»“æ„è¯´æ˜](#ç›®å½•ç»“æ„è¯´æ˜)
4. [S3 å­˜å‚¨ç»“æ„](#s3-å­˜å‚¨ç»“æ„)
5. [æ„å»ºæµç¨‹è¯¦è§£](#æ„å»ºæµç¨‹è¯¦è§£)
6. [å®¢æˆ·ç«¯æ›´æ–°æµç¨‹](#å®¢æˆ·ç«¯æ›´æ–°æµç¨‹)
7. [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
8. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ç³»ç»Ÿæ¦‚è¿°

eCan é‡‡ç”¨è‡ªå»ºçš„ OTA (Over-The-Air) æ›´æ–°ç³»ç»Ÿï¼Œæ”¯æŒ Windows å’Œ macOS å¹³å°çš„è‡ªåŠ¨æ›´æ–°ã€‚

### æ ¸å¿ƒç‰¹æ€§

- âœ… **å¤šç¯å¢ƒæ”¯æŒ**: development, test, staging, production
- âœ… **å¤šæ¸ é“å‘å¸ƒ**: dev, beta, stable
- âœ… **å¢é‡æ›´æ–°**: æ”¯æŒåˆ†å¼€æ„å»ºä¸åŒå¹³å°
- âœ… **ç­¾åéªŒè¯**: Ed25519 æ•°å­—ç­¾åä¿è¯å®‰å…¨æ€§
- âœ… **å¤šè¯­è¨€æ”¯æŒ**: Appcast æ”¯æŒä¸­è‹±æ–‡
- âœ… **CDN åŠ é€Ÿ**: S3 Transfer Acceleration å…¨çƒåŠ é€Ÿ

### æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯ |
|------|------|
| **å­˜å‚¨** | AWS S3 |
| **æ ¼å¼** | Sparkle-compatible Appcast XML |
| **ç­¾å** | Ed25519 (EdDSA) |
| **å®¢æˆ·ç«¯** | è‡ªå»º Python OTA å®¢æˆ·ç«¯ |
| **æ„å»º** | GitHub Actions |

---

## OTA å·¥ä½œæµç¨‹

### å®Œæ•´æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é˜¶æ®µ 1: æ„å»ºä¸å‘å¸ƒ                             â”‚
â”‚                  (GitHub Actions Workflow)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                     â†“                     â†“
   [éªŒè¯æ ‡ç­¾]            [æ„å»º Windows]        [æ„å»º macOS]
   validate-tag         build-windows         build-macos
   - æ£€æµ‹ç¯å¢ƒ            - ç¼–è¯‘åº”ç”¨            - ç¼–è¯‘åº”ç”¨
   - æ£€æµ‹æ¸ é“            - ä»£ç ç­¾å            - ä»£ç ç­¾å
   - éªŒè¯ç‰ˆæœ¬            - æ‰“åŒ… exe/msi        - å…¬è¯
        â”‚                     â”‚                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              é˜¶æ®µ 2: ä¸Šä¼ åˆ° S3                                   â”‚
â”‚         (upload_to_s3.py - å¢é‡æ›´æ–°ç­–ç•¥)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                     â†“                     â†“
   [ä¸Šä¼ å®‰è£…åŒ…]          [ä¸Šä¼ ç­¾å]           [ä¸Šä¼ å…ƒæ•°æ®]
   .exe/.pkg            .sig/.sha256         version.json
        â”‚                     â”‚                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
        è·¯å¾„: {env}/releases/v{ver}/{platform}/{arch}/
        ç¤ºä¾‹: production/releases/v1.0.0/macos/aarch64/
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         é˜¶æ®µ 3: ç”Ÿæˆ Appcast XML                                 â”‚
â”‚      (generate_appcast.py - å¢é‡æ›´æ–°ç­–ç•¥)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                     â†“                     â†“
   [æ‰«æ S3]            [ç”Ÿæˆ XML]           [ç”Ÿæˆ latest.json]
   åˆ—å‡ºæ‰€æœ‰ç‰ˆæœ¬          Sparkle æ ¼å¼         å¢é‡åˆå¹¶å¹³å°ä¿¡æ¯
        â”‚                     â”‚                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
        è·¯å¾„: {env}/channels/{channel}/appcast-{platform}-{arch}.xml
        ç¤ºä¾‹: production/channels/stable/appcast-macos-aarch64.xml
              production/latest.json
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         é˜¶æ®µ 4: ç”Ÿæˆä¸‹è½½é“¾æ¥                                     â”‚
â”‚      (shared-download-links.yml)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
        ç”Ÿæˆ: download-links-{version}.txt
        åŒ…å«: æ‰€æœ‰å¹³å°çš„æ ‡å‡†å’ŒåŠ é€Ÿä¸‹è½½é“¾æ¥

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é˜¶æ®µ 5: å®¢æˆ·ç«¯æ£€æŸ¥æ›´æ–°                         â”‚
â”‚                  (OTAUpdater â†’ Platform Updater)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                     â†“                     â†“
   [è‡ªåŠ¨æ£€æŸ¥]            [æ‰‹åŠ¨æ£€æŸ¥]            [å¯åŠ¨æ£€æŸ¥]
   å®šæ—¶è§¦å‘              ç”¨æˆ·ç‚¹å‡»              å»¶è¿Ÿå¯åŠ¨
   (4å°æ—¶/ç”Ÿäº§)          (ç«‹å³)               (2åˆ†é’Ÿå)
        â”‚                     â”‚                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         é˜¶æ®µ 6: è·å– Appcast XML                                 â”‚
â”‚      (MacOSUpdater/WindowsUpdater)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
        URL: https://ecan-releases.s3.us-east-1.amazonaws.com/
             {env}/channels/{channel}/appcast-{platform}-{arch}.xml
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         é˜¶æ®µ 7: è§£æ Appcast & ç‰ˆæœ¬æ¯”è¾ƒ                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
        - æå–æœ€æ–°ç‰ˆæœ¬ä¿¡æ¯
        - æ¯”è¾ƒå½“å‰ç‰ˆæœ¬ vs æœ€æ–°ç‰ˆæœ¬
        - éªŒè¯ç­¾å (ç”Ÿäº§ç¯å¢ƒå¿…é¡»)
                              â†“
                    [æœ‰æ–°ç‰ˆæœ¬å¯ç”¨ï¼Ÿ]
                              â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â†“                   â†“
                 [æ˜¯]                 [å¦]
                    â†“                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   [ç»“æŸæ£€æŸ¥]
â”‚   é˜¶æ®µ 8: æ˜¾ç¤ºæ›´æ–°é€šçŸ¥        â”‚
â”‚  - UpdateDialog              â”‚
â”‚  - UpdateNotificationDialog  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
        [ç”¨æˆ·é€‰æ‹©ä¸‹è½½/å®‰è£…]
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         é˜¶æ®µ 9: ä¸‹è½½å®‰è£…åŒ…                                       â”‚
â”‚      (PackageManager)                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
        URL: {env}/releases/v{ver}/{platform}/{arch}/{file}
        æ”¯æŒ: æ–­ç‚¹ç»­ä¼ ã€è¿›åº¦æ˜¾ç¤º
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         é˜¶æ®µ 10: éªŒè¯å®‰è£…åŒ…                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
        - æ ¡éªŒ SHA256
        - éªŒè¯ Ed25519 ç­¾å (ç”Ÿäº§ç¯å¢ƒ)
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         é˜¶æ®µ 11: å®‰è£…æ›´æ–°                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
        macOS: æ‰§è¡Œ .pkg å®‰è£…
        Windows: æ‰§è¡Œ .exe/.msi å®‰è£…
                    â†“
            [é‡å¯åº”ç”¨å®Œæˆæ›´æ–°]
```

---

## S3 å­˜å‚¨ç»“æ„

### å®Œæ•´ S3 ç›®å½•æ ‘

```
s3://ecan-releases/
â”œâ”€â”€ dev/                                   # å¼€å‘ç¯å¢ƒ
â”‚   â”œâ”€â”€ releases/                          # ç‰ˆæœ¬å‘å¸ƒ
â”‚   â”‚   â”œâ”€â”€ v1.0.0/                       # ç‰ˆæœ¬å·
â”‚   â”‚   â”‚   â”œâ”€â”€ macos/                    # macOS å¹³å°
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ aarch64/              # ARM64 æ¶æ„
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ eCan-1.0.0-macos-aarch64.pkg
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ eCan-1.0.0-macos-aarch64.pkg.sha256
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ eCan-1.0.0-macos-aarch64.pkg.sig
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ amd64/                # Intel æ¶æ„
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ eCan-1.0.0-macos-amd64.pkg
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ eCan-1.0.0-macos-amd64.pkg.sha256
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ eCan-1.0.0-macos-amd64.pkg.sig
â”‚   â”‚   â”‚   â”œâ”€â”€ windows/                  # Windows å¹³å°
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ amd64/                # x64 æ¶æ„
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ eCan-1.0.0-windows-amd64-Setup.exe
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ eCan-1.0.0-windows-amd64-Setup.exe.sha256
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ eCan-1.0.0-windows-amd64-Setup.exe.sig
â”‚   â”‚   â”‚   â””â”€â”€ metadata/                 # ç‰ˆæœ¬å…ƒæ•°æ®
â”‚   â”‚   â”‚       â””â”€â”€ version.json          # ç‰ˆæœ¬ä¿¡æ¯ (å¢é‡æ›´æ–°)
â”‚   â”‚   â””â”€â”€ v1.0.1/                       # ä¸‹ä¸€ä¸ªç‰ˆæœ¬
â”‚   â”‚       â””â”€â”€ ...
â”‚   â”œâ”€â”€ channels/                          # å‘å¸ƒæ¸ é“
â”‚   â”‚   â””â”€â”€ dev/                          # å¼€å‘æ¸ é“
â”‚   â”‚       â”œâ”€â”€ appcast-macos-aarch64.xml
â”‚   â”‚       â”œâ”€â”€ appcast-macos-amd64.xml
â”‚   â”‚       â”œâ”€â”€ appcast-windows-amd64.xml
â”‚   â”‚       â”œâ”€â”€ appcast-macos-aarch64.zh-CN.xml  # ä¸­æ–‡ç‰ˆ
â”‚   â”‚       â””â”€â”€ appcast-macos-amd64.zh-CN.xml
â”‚   â””â”€â”€ latest.json                        # æœ€æ–°ç‰ˆæœ¬ä¿¡æ¯ (å¢é‡æ›´æ–°)
â”‚
â”œâ”€â”€ test/                                  # æµ‹è¯•ç¯å¢ƒ
â”‚   â”œâ”€â”€ releases/
â”‚   â”‚   â””â”€â”€ v1.0.0/
â”‚   â”‚       â””â”€â”€ ...
â”‚   â”œâ”€â”€ channels/
â”‚   â”‚   â””â”€â”€ beta/                         # Beta æ¸ é“
â”‚   â”‚       â””â”€â”€ ...
â”‚   â””â”€â”€ latest.json
â”‚
â”œâ”€â”€ staging/                               # é¢„å‘å¸ƒç¯å¢ƒ
â”‚   â”œâ”€â”€ releases/
â”‚   â”‚   â””â”€â”€ v1.0.0/
â”‚   â”‚       â””â”€â”€ ...
â”‚   â”œâ”€â”€ channels/
â”‚   â”‚   â””â”€â”€ stable/                       # ç¨³å®šæ¸ é“
â”‚   â”‚       â””â”€â”€ ...
â”‚   â””â”€â”€ latest.json
â”‚
â””â”€â”€ production/                            # ç”Ÿäº§ç¯å¢ƒ
    â”œâ”€â”€ releases/
    â”‚   â””â”€â”€ v1.0.0/
    â”‚       â””â”€â”€ ...
    â”œâ”€â”€ channels/
    â”‚   â””â”€â”€ stable/                       # ç¨³å®šæ¸ é“
    â”‚       â””â”€â”€ ...
    â””â”€â”€ latest.json
```

### è·¯å¾„è§„åˆ™

#### 1. å®‰è£…åŒ…è·¯å¾„
```
{environment}/releases/v{version}/{platform}/{arch}/{filename}
```

**ç¤ºä¾‹**:
```
production/releases/v1.0.0/macos/aarch64/eCan-1.0.0-macos-aarch64.pkg
production/releases/v1.0.0/windows/amd64/eCan-1.0.0-windows-amd64-Setup.exe
```

#### 2. Appcast è·¯å¾„
```
{environment}/channels/{channel}/appcast-{platform}-{arch}.xml
{environment}/channels/{channel}/appcast-{platform}-{arch}.{language}.xml
```

**ç¤ºä¾‹**:
```
production/channels/stable/appcast-macos-aarch64.xml
production/channels/stable/appcast-macos-aarch64.zh-CN.xml
```

#### 3. å…ƒæ•°æ®è·¯å¾„
```
{environment}/releases/v{version}/metadata/version.json  # ç‰ˆæœ¬å…ƒæ•°æ®
{environment}/latest.json                                 # æœ€æ–°ç‰ˆæœ¬ä¿¡æ¯
```

### URL æ ¼å¼

#### æ ‡å‡† URL
```
https://{bucket}.s3.{region}.amazonaws.com/{path}
```

**ç¤ºä¾‹**:
```
https://ecan-releases.s3.us-east-1.amazonaws.com/production/releases/v1.0.0/macos/aarch64/eCan-1.0.0-macos-aarch64.pkg
```

#### åŠ é€Ÿ URL (S3 Transfer Acceleration)
```
https://{bucket}.s3-accelerate.amazonaws.com/{path}
```

**ç¤ºä¾‹**:
```
https://ecan-releases.s3-accelerate.amazonaws.com/production/releases/v1.0.0/macos/aarch64/eCan-1.0.0-macos-aarch64.pkg
```

---


## é…ç½®è¯´æ˜

### OTA é…ç½®æ–‡ä»¶

**æ–‡ä»¶**: `ota/config/ota_config.yaml`

```yaml
# OTA åŠŸèƒ½å¼€å…³
ota_enabled: true

# å½“å‰ç¯å¢ƒ (æ„å»ºæ—¶æ³¨å…¥)
environment: production

# é€šç”¨é…ç½®
common:
  app_name: "eCan"
  s3_bucket: "ecan-releases"
  s3_region: "us-east-1"
  s3_base_path: ""

# ç¯å¢ƒé…ç½®
environments:
  production:
    s3_prefix: "production"
    channel: "stable"
    appcast_base: "https://ecan-releases.s3.us-east-1.amazonaws.com/production"
    signature_required: true
    signature_verification: true
    auto_check: true
    check_interval: 14400  # 4å°æ—¶
    auto_check_initial_delay: 120  # 2åˆ†é’Ÿ
    silent_mode: true
    allow_http: false
```

### ç¯å¢ƒå˜é‡

| å˜é‡ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `AWS_ACCESS_KEY_ID` | AWS è®¿é—®å¯†é’¥ | (GitHub Secrets) |
| `AWS_SECRET_ACCESS_KEY` | AWS å¯†é’¥ | (GitHub Secrets) |
| `AWS_REGION` | AWS åŒºåŸŸ | `us-east-1` |
| `S3_BUCKET` | S3 æ¡¶å | `ecan-releases` |
| `OTA_ED25519_PRIVATE_KEY` | ç­¾åç§é’¥ | (GitHub Secrets) |

---

## å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•æ”¯æŒåˆ†å¼€æ„å»ºä¸åŒå¹³å°ï¼Ÿ

**A**: æ‰€æœ‰å…³é”®æ–‡ä»¶éƒ½æ”¯æŒå¢é‡æ›´æ–°ï¼š
- `version.json` (metadata) - åˆå¹¶æ–‡ä»¶åˆ—è¡¨
- `latest.json` - åˆå¹¶å¹³å°ä¿¡æ¯
- Appcast XML - æ¯ä¸ªå¹³å°ç‹¬ç«‹æ–‡ä»¶

### Q2: å¦‚ä½•éªŒè¯ç­¾åï¼Ÿ

**A**: 
```python
# ç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨éªŒè¯
if ota_config.is_signature_required():
    package_manager._verify_signature(file_path, signature)
```

### Q3: å¦‚ä½•æ·»åŠ æ–°è¯­è¨€æ”¯æŒï¼Ÿ

**A**: 
1. åœ¨ `generate_appcast.py` ä¸­æ·»åŠ è¯­è¨€ä»£ç 
2. ç”Ÿæˆå¯¹åº”çš„ Appcast XML: `appcast-{platform}-{arch}.{lang}.xml`
3. å®¢æˆ·ç«¯è‡ªåŠ¨æ ¹æ®ç³»ç»Ÿè¯­è¨€é€‰æ‹©

### Q4: å¦‚ä½•æ¸…ç†æ—§ç‰ˆæœ¬ï¼Ÿ

**A**: 
```bash
# æ‰‹åŠ¨åˆ é™¤ S3 ä¸Šçš„æ—§ç‰ˆæœ¬ç›®å½•
aws s3 rm s3://ecan-releases/production/releases/v0.0.1/ --recursive

# é‡æ–°ç”Ÿæˆ Appcast
python3 build_system/scripts/generate_appcast.py --env production
```

### Q5: å¦‚ä½•æµ‹è¯• OTA æ›´æ–°ï¼Ÿ

**A**: 
1. ä½¿ç”¨ `test` æˆ– `staging` ç¯å¢ƒ
2. é…ç½® `ota_config.yaml` æŒ‡å‘æµ‹è¯•ç¯å¢ƒ
3. ä½¿ç”¨ `release-simulate.yml` æ¨¡æ‹Ÿå‘å¸ƒ

---

**ç»´æŠ¤è€…**: eCan.ai Development Team  
**æœ€åæ›´æ–°**: 2025-12-08
